<?xml version="1.0" encoding="utf-8"?>
<templates xml:space="preserve">

    <t t-name="tekprowess_manufacturing.ManufacturingDashboard">
        <Layout display="{ breadcrumbs: props.breadcrumbs }">
            <t t-set-slot="control-panel-additional-actions">
                <button class="tp_refresh_btn btn btn-sm" t-on-click="() => this.refresh()">
                    <i class="fa fa-refresh me-1"/> Refresh
                </button>
            </t>

            <div class="tp_dashboard_wrap">

                <t t-if="state.loading">
                    <div class="tp_loading">
                        <i class="fa fa-circle-o-notch fa-spin me-2"/> Loading Dashboard…
                    </div>
                </t>

                <t t-else="">

                    <!-- ═══════════════════════════════════════════
                         MANUFACTURING SECTION
                    ════════════════════════════════════════════ -->
                    <t t-if="this.section === 'manufacturing'">

                        <div class="tp_section_header">
                            <i class="fa fa-industry me-2"/>Manufacturing Orders
                            <span class="tp_section_badge" t-on-click="onClickMfgAll">
                                <t t-esc="state.data.total or 0"/> Total
                            </span>
                        </div>

                        <!-- Row 1: Wide chart card + state cards -->
                        <div class="tp_cards_row">
                            <div class="tp_card tp_card_wide tp_card_purple">
                                <div class="tp_card_top">
                                    <div>
                                        <div class="tp_card_label">Manufacturing Orders</div>
                                        <div class="tp_card_big" t-on-click="onClickMfgAll"><t t-esc="state.data.total or 0"/></div>
                                    </div>
                                    <div class="tp_card_stats_right">
                                        <div class="tp_stat_row"><span class="tp_sl">Today</span><span class="tp_sv" t-on-click="onClickMfgAll"><t t-esc="state.data.today or 0"/></span></div>
                                        <div class="tp_stat_row"><span class="tp_sl">Overdue</span><span class="tp_sv tp_red" t-on-click="onClickMfgAll"><t t-esc="state.data.overdue or 0"/></span></div>
                                        <div class="tp_stat_row"><span class="tp_sl">In Progress</span><span class="tp_sv tp_orange" t-on-click="onClickMfgProgress"><t t-esc="state.data.progress or 0"/></span></div>
                                        <div class="tp_stat_row"><span class="tp_sl">Done</span><span class="tp_sv tp_green" t-on-click="onClickMfgDone"><t t-esc="state.data.done or 0"/></span></div>
                                    </div>
                                </div>
                                <div class="tp_chart_area"><canvas t-ref="mainChart"/></div>
                            </div>
                            <div class="tp_card">
                                <div class="tp_card_header_row"><span class="tp_card_title">Draft</span><button class="tp_btn" t-on-click="onClickMfgDraft">Open</button></div>
                                <div class="tp_count_big" t-on-click="onClickMfgDraft"><t t-esc="state.data.draft or 0"/></div>
                                <div class="tp_card_sub">Manufacturing Orders</div>
                            </div>
                            <div class="tp_card">
                                <div class="tp_card_header_row"><span class="tp_card_title">Confirmed</span><button class="tp_btn" t-on-click="onClickMfgConfirmed">Open</button></div>
                                <div class="tp_count_big" t-on-click="onClickMfgConfirmed"><t t-esc="state.data.confirmed or 0"/></div>
                                <div class="tp_card_sub">Manufacturing Orders</div>
                            </div>
                            <div class="tp_card">
                                <div class="tp_card_header_row"><span class="tp_card_title">In Progress</span><button class="tp_btn" t-on-click="onClickMfgProgress">Open</button></div>
                                <div class="tp_count_big tp_orange" t-on-click="onClickMfgProgress"><t t-esc="state.data.progress or 0"/></div>
                                <div class="tp_card_sub">Manufacturing Orders</div>
                            </div>
                            <div class="tp_card">
                                <div class="tp_card_header_row"><span class="tp_card_title">Done</span><button class="tp_btn tp_btn_secondary" t-on-click="onClickMfgDone">Open</button></div>
                                <div class="tp_count_big tp_green" t-on-click="onClickMfgDone"><t t-esc="state.data.done or 0"/></div>
                                <div class="tp_card_sub">Manufacturing Orders</div>
                            </div>
                        </div>

                        <!-- Row 2: KPI Tiles -->
                        <div class="tp_section_header tp_mt16"><i class="fa fa-tachometer me-2"/>Key Metrics</div>
                        <div class="tp_kpi_row">
                            <div class="tp_kpi_tile tp_kpi_purple">
                                <div class="tp_kpi_icon"><i class="fa fa-check-circle"/></div>
                                <div class="tp_kpi_val"><t t-esc="state.data.month_done or 0"/></div>
                                <div class="tp_kpi_label">Done This Month</div>
                            </div>
                            <div class="tp_kpi_tile tp_kpi_orange">
                                <div class="tp_kpi_icon"><i class="fa fa-spinner"/></div>
                                <div class="tp_kpi_val"><t t-esc="state.data.progress or 0"/></div>
                                <div class="tp_kpi_label">In Progress</div>
                            </div>
                            <div class="tp_kpi_tile tp_kpi_red">
                                <div class="tp_kpi_icon"><i class="fa fa-exclamation-circle"/></div>
                                <div class="tp_kpi_val"><t t-esc="state.data.overdue or 0"/></div>
                                <div class="tp_kpi_label">Overdue</div>
                            </div>
                            <div class="tp_kpi_tile tp_kpi_green">
                                <div class="tp_kpi_icon"><i class="fa fa-calendar-check-o"/></div>
                                <div class="tp_kpi_val"><t t-esc="state.data.today or 0"/></div>
                                <div class="tp_kpi_label">Scheduled Today</div>
                            </div>
                            <div class="tp_kpi_tile tp_kpi_blue">
                                <div class="tp_kpi_icon"><i class="fa fa-ban"/></div>
                                <div class="tp_kpi_val"><t t-esc="state.data.cancel or 0"/></div>
                                <div class="tp_kpi_label">Cancelled</div>
                            </div>
                        </div>

                        <!-- Row 3: Recent Orders table + Workcenter utilization -->
                        <div class="tp_bottom_row">
                            <!-- Recent Orders -->
                            <div class="tp_table_card">
                                <div class="tp_table_header">
                                    <span><i class="fa fa-list me-2"/>Recent Manufacturing Orders</span>
                                    <button class="tp_btn" t-on-click="onClickMfgAll">View All</button>
                                </div>
                                <table class="tp_table">
                                    <thead>
                                        <tr>
                                            <th>Reference</th>
                                            <th>Product</th>
                                            <th>Qty</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="state.data.recent_orders or []" t-as="row" t-key="row.id">
                                            <tr t-on-click="() => this.openMfgOrder(row.id)" class="tp_table_row">
                                                <td class="tp_td_name"><t t-esc="row.name"/></td>
                                                <td><t t-esc="row.product"/></td>
                                                <td><t t-esc="row.qty"/> <span class="tp_uom"><t t-esc="row.uom"/></span></td>
                                                <td><t t-esc="row.date"/></td>
                                                <td><span t-attf-class="tp_badge tp_badge_#{row.state}"><t t-esc="row.state_label"/></span></td>
                                            </tr>
                                        </t>
                                        <t t-if="!(state.data.recent_orders and state.data.recent_orders.length)">
                                            <tr><td colspan="5" class="tp_no_data">No manufacturing orders found.</td></tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Workcenter Utilization -->
                            <div class="tp_side_card" t-if="state.data.workcenters and state.data.workcenters.length">
                                <div class="tp_table_header">
                                    <span><i class="fa fa-cogs me-2"/>Workcenter Utilization</span>
                                </div>
                                <div class="tp_wc_list">
                                    <t t-foreach="state.data.workcenters or []" t-as="wc" t-key="wc.name">
                                        <div class="tp_wc_item">
                                            <div class="tp_wc_name"><t t-esc="wc.name"/></div>
                                            <div class="tp_wc_bar_wrap">
                                                <div class="tp_wc_bar" t-attf-style="width: #{wc.pct}%"/>
                                            </div>
                                            <div class="tp_wc_pct"><t t-esc="wc.done"/>/<t t-esc="wc.total"/> (<t t-esc="wc.pct"/>%)</div>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </t>

                    <!-- ═══════════════════════════════════════════
                         SALES SECTION
                    ════════════════════════════════════════════ -->
                    <t t-if="this.section === 'sales'">

                        <div class="tp_section_header">
                            <i class="fa fa-shopping-cart me-2"/>Sales Orders
                            <span class="tp_section_badge" t-on-click="onClickSaleAll"><t t-esc="state.data.total or 0"/> Total</span>
                        </div>

                        <!-- Row 1: Wide chart card + state cards -->
                        <div class="tp_cards_row">
                            <div class="tp_card tp_card_wide tp_card_blue">
                                <div class="tp_card_top">
                                    <div>
                                        <div class="tp_card_label">Sales Orders</div>
                                        <div class="tp_card_big" t-on-click="onClickSaleAll"><t t-esc="state.data.total or 0"/></div>
                                    </div>
                                    <div class="tp_card_stats_right">
                                        <div class="tp_stat_row"><span class="tp_sl">This Month</span><span class="tp_sv"><t t-esc="this.fmt(state.data.month_amount, state.data.currency_symbol)"/></span></div>
                                        <div class="tp_stat_row"><span class="tp_sl">Confirmed</span><span class="tp_sv tp_orange" t-on-click="onClickSaleConfirmed"><t t-esc="state.data.sale or 0"/></span></div>
                                        <div class="tp_stat_row"><span class="tp_sl">To Invoice</span><span class="tp_sv tp_red" t-on-click="onClickSaleToInvoice"><t t-esc="state.data.to_invoice or 0"/></span></div>
                                        <div class="tp_stat_row"><span class="tp_sl">Overdue</span><span class="tp_sv tp_red" t-on-click="onClickSaleAll"><t t-esc="state.data.overdue or 0"/></span></div>
                                    </div>
                                </div>
                                <div class="tp_chart_area"><canvas t-ref="mainChart"/></div>
                            </div>
                            <div class="tp_card">
                                <div class="tp_card_header_row"><span class="tp_card_title">Quotations</span><button class="tp_btn" t-on-click="onClickSaleQuotation">New</button></div>
                                <div class="tp_count_big" t-on-click="onClickSaleQuotation"><t t-esc="state.data.quotation or 0"/></div>
                                <div class="tp_stat_row tp_mt8"><span class="tp_sl">Sent</span><span class="tp_sv" t-on-click="onClickSaleSent"><t t-esc="state.data.sent or 0"/></span></div>
                            </div>
                            <div class="tp_card">
                                <div class="tp_card_header_row"><span class="tp_card_title">Sales Orders</span><button class="tp_btn" t-on-click="onClickSaleConfirmed">Open</button></div>
                                <div class="tp_count_big tp_orange" t-on-click="onClickSaleConfirmed"><t t-esc="state.data.sale or 0"/></div>
                                <div class="tp_stat_row tp_mt8"><span class="tp_sl">Amount</span><span class="tp_sv"><t t-esc="this.fmt(state.data.confirmed_amount, state.data.currency_symbol)"/></span></div>
                            </div>
                            <div class="tp_card">
                                <div class="tp_card_header_row"><span class="tp_card_title">To Invoice</span><button class="tp_btn" t-on-click="onClickSaleToInvoice">Open</button></div>
                                <div class="tp_count_big tp_red" t-on-click="onClickSaleToInvoice"><t t-esc="state.data.to_invoice or 0"/></div>
                                <div class="tp_card_sub">Pending invoicing</div>
                            </div>
                            <div class="tp_card">
                                <div class="tp_card_header_row"><span class="tp_card_title">Locked</span><button class="tp_btn tp_btn_secondary" t-on-click="onClickSaleDone">Open</button></div>
                                <div class="tp_count_big tp_green" t-on-click="onClickSaleDone"><t t-esc="state.data.done or 0"/></div>
                                <div class="tp_card_sub">Sales Orders</div>
                            </div>
                        </div>

                        <!-- Row 2: KPI Tiles -->
                        <div class="tp_section_header tp_mt16"><i class="fa fa-tachometer me-2"/>Key Metrics</div>
                        <div class="tp_kpi_row">
                            <div class="tp_kpi_tile tp_kpi_blue">
                                <div class="tp_kpi_icon"><i class="fa fa-dollar"/></div>
                                <div class="tp_kpi_val tp_kpi_sm"><t t-esc="this.fmt(state.data.month_amount, state.data.currency_symbol)"/></div>
                                <div class="tp_kpi_label">This Month Revenue</div>
                            </div>
                            <div class="tp_kpi_tile tp_kpi_green">
                                <div class="tp_kpi_icon"><i class="fa fa-line-chart"/></div>
                                <div class="tp_kpi_val tp_kpi_sm"><t t-esc="this.fmt(state.data.avg_order_val, state.data.currency_symbol)"/></div>
                                <div class="tp_kpi_label">Avg Order Value</div>
                            </div>
                            <div class="tp_kpi_tile tp_kpi_orange">
                                <div class="tp_kpi_icon"><i class="fa fa-file-text"/></div>
                                <div class="tp_kpi_val"><t t-esc="state.data.month_count or 0"/></div>
                                <div class="tp_kpi_label">Orders This Month</div>
                            </div>
                            <div class="tp_kpi_tile tp_kpi_red">
                                <div class="tp_kpi_icon"><i class="fa fa-clock-o"/></div>
                                <div class="tp_kpi_val"><t t-esc="state.data.to_invoice or 0"/></div>
                                <div class="tp_kpi_label">Awaiting Invoice</div>
                            </div>
                            <div class="tp_kpi_tile tp_kpi_purple">
                                <div class="tp_kpi_icon"><i class="fa fa-ban"/></div>
                                <div class="tp_kpi_val"><t t-esc="state.data.cancel or 0"/></div>
                                <div class="tp_kpi_label">Cancelled</div>
                            </div>
                        </div>

                        <!-- Row 3: Recent Orders table + Top Customers -->
                        <div class="tp_bottom_row">
                            <div class="tp_table_card">
                                <div class="tp_table_header">
                                    <span><i class="fa fa-list me-2"/>Recent Sales Orders</span>
                                    <button class="tp_btn" t-on-click="onClickSaleAll">View All</button>
                                </div>
                                <table class="tp_table">
                                    <thead>
                                        <tr><th>Reference</th><th>Customer</th><th>Amount</th><th>Date</th><th>Status</th></tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="state.data.recent_orders or []" t-as="row" t-key="row.id">
                                            <tr t-on-click="() => this.openSaleOrder(row.id)" class="tp_table_row">
                                                <td class="tp_td_name"><t t-esc="row.name"/></td>
                                                <td><t t-esc="row.partner"/></td>
                                                <td><t t-esc="this.fmt(row.amount, state.data.currency_symbol)"/></td>
                                                <td><t t-esc="row.date"/></td>
                                                <td><span t-attf-class="tp_badge tp_badge_#{row.state}"><t t-esc="row.state_label"/></span></td>
                                            </tr>
                                        </t>
                                        <t t-if="!(state.data.recent_orders and state.data.recent_orders.length)">
                                            <tr><td colspan="5" class="tp_no_data">No sales orders found.</td></tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Top Customers -->
                            <div class="tp_side_card" t-if="state.data.top_customers and state.data.top_customers.length">
                                <div class="tp_table_header"><span><i class="fa fa-star me-2"/>Top Customers</span></div>
                                <div class="tp_wc_list">
                                    <t t-foreach="state.data.top_customers or []" t-as="c" t-key="c.name">
                                        <div class="tp_wc_item">
                                            <div class="tp_wc_name"><t t-esc="c.name"/></div>
                                            <div class="tp_wc_pct tp_green"><t t-esc="this.fmt(c.amount, state.data.currency_symbol)"/></div>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </t>

                    <!-- ═══════════════════════════════════════════
                         PURCHASE SECTION
                    ════════════════════════════════════════════ -->
                    <t t-if="this.section === 'purchase'">

                        <div class="tp_section_header">
                            <i class="fa fa-shopping-basket me-2"/>Purchase Orders
                            <span class="tp_section_badge" t-on-click="onClickPurchaseAll"><t t-esc="state.data.total or 0"/> Total</span>
                        </div>

                        <!-- Row 1: Wide chart card + state cards -->
                        <div class="tp_cards_row">
                            <div class="tp_card tp_card_wide tp_card_orange">
                                <div class="tp_card_top">
                                    <div>
                                        <div class="tp_card_label">Purchase Orders</div>
                                        <div class="tp_card_big" t-on-click="onClickPurchaseAll"><t t-esc="state.data.total or 0"/></div>
                                    </div>
                                    <div class="tp_card_stats_right">
                                        <div class="tp_stat_row"><span class="tp_sl">This Month</span><span class="tp_sv"><t t-esc="this.fmt(state.data.month_amount, state.data.currency_symbol)"/></span></div>
                                        <div class="tp_stat_row"><span class="tp_sl">Confirmed</span><span class="tp_sv tp_orange" t-on-click="onClickPurchaseConfirmed"><t t-esc="state.data.purchase or 0"/></span></div>
                                        <div class="tp_stat_row"><span class="tp_sl">To Bill</span><span class="tp_sv tp_red" t-on-click="onClickPurchaseToBill"><t t-esc="state.data.to_bill or 0"/></span></div>
                                        <div class="tp_stat_row"><span class="tp_sl">Overdue</span><span class="tp_sv tp_red" t-on-click="onClickPurchaseAll"><t t-esc="state.data.overdue or 0"/></span></div>
                                    </div>
                                </div>
                                <div class="tp_chart_area"><canvas t-ref="mainChart"/></div>
                            </div>
                            <div class="tp_card">
                                <div class="tp_card_header_row"><span class="tp_card_title">RFQ</span><button class="tp_btn" t-on-click="onClickPurchaseDraft">New</button></div>
                                <div class="tp_count_big" t-on-click="onClickPurchaseDraft"><t t-esc="state.data.draft or 0"/></div>
                                <div class="tp_stat_row tp_mt8"><span class="tp_sl">Sent</span><span class="tp_sv" t-on-click="onClickPurchaseSent"><t t-esc="state.data.sent or 0"/></span></div>
                            </div>
                            <div class="tp_card">
                                <div class="tp_card_header_row"><span class="tp_card_title">Purchase Orders</span><button class="tp_btn" t-on-click="onClickPurchaseConfirmed">Open</button></div>
                                <div class="tp_count_big tp_orange" t-on-click="onClickPurchaseConfirmed"><t t-esc="state.data.purchase or 0"/></div>
                                <div class="tp_stat_row tp_mt8"><span class="tp_sl">Amount</span><span class="tp_sv"><t t-esc="this.fmt(state.data.confirmed_amount, state.data.currency_symbol)"/></span></div>
                            </div>
                            <div class="tp_card">
                                <div class="tp_card_header_row"><span class="tp_card_title">To Bill</span><button class="tp_btn" t-on-click="onClickPurchaseToBill">Open</button></div>
                                <div class="tp_count_big tp_red" t-on-click="onClickPurchaseToBill"><t t-esc="state.data.to_bill or 0"/></div>
                                <div class="tp_card_sub">Pending billing</div>
                            </div>
                            <div class="tp_card">
                                <div class="tp_card_header_row"><span class="tp_card_title">Done</span><button class="tp_btn tp_btn_secondary" t-on-click="onClickPurchaseDone">Open</button></div>
                                <div class="tp_count_big tp_green" t-on-click="onClickPurchaseDone"><t t-esc="state.data.done or 0"/></div>
                                <div class="tp_card_sub">Purchase Orders</div>
                            </div>
                        </div>

                        <!-- Row 2: KPI Tiles -->
                        <div class="tp_section_header tp_mt16"><i class="fa fa-tachometer me-2"/>Key Metrics</div>
                        <div class="tp_kpi_row">
                            <div class="tp_kpi_tile tp_kpi_orange">
                                <div class="tp_kpi_icon"><i class="fa fa-dollar"/></div>
                                <div class="tp_kpi_val tp_kpi_sm"><t t-esc="this.fmt(state.data.month_amount, state.data.currency_symbol)"/></div>
                                <div class="tp_kpi_label">This Month Spend</div>
                            </div>
                            <div class="tp_kpi_tile tp_kpi_green">
                                <div class="tp_kpi_icon"><i class="fa fa-line-chart"/></div>
                                <div class="tp_kpi_val tp_kpi_sm"><t t-esc="this.fmt(state.data.avg_order_val, state.data.currency_symbol)"/></div>
                                <div class="tp_kpi_label">Avg Order Value</div>
                            </div>
                            <div class="tp_kpi_tile tp_kpi_blue">
                                <div class="tp_kpi_icon"><i class="fa fa-file-text"/></div>
                                <div class="tp_kpi_val"><t t-esc="state.data.month_count or 0"/></div>
                                <div class="tp_kpi_label">Orders This Month</div>
                            </div>
                            <div class="tp_kpi_tile tp_kpi_red">
                                <div class="tp_kpi_icon"><i class="fa fa-clock-o"/></div>
                                <div class="tp_kpi_val"><t t-esc="state.data.to_bill or 0"/></div>
                                <div class="tp_kpi_label">Awaiting Bill</div>
                            </div>
                            <div class="tp_kpi_tile tp_kpi_purple">
                                <div class="tp_kpi_icon"><i class="fa fa-exclamation-triangle"/></div>
                                <div class="tp_kpi_val"><t t-esc="state.data.overdue or 0"/></div>
                                <div class="tp_kpi_label">Overdue Deliveries</div>
                            </div>
                        </div>

                        <!-- Row 3: Recent Orders table + Top Vendors -->
                        <div class="tp_bottom_row">
                            <div class="tp_table_card">
                                <div class="tp_table_header">
                                    <span><i class="fa fa-list me-2"/>Recent Purchase Orders</span>
                                    <button class="tp_btn" t-on-click="onClickPurchaseAll">View All</button>
                                </div>
                                <table class="tp_table">
                                    <thead>
                                        <tr><th>Reference</th><th>Vendor</th><th>Amount</th><th>Date</th><th>Status</th></tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="state.data.recent_orders or []" t-as="row" t-key="row.id">
                                            <tr t-on-click="() => this.openPurchaseOrder(row.id)" class="tp_table_row">
                                                <td class="tp_td_name"><t t-esc="row.name"/></td>
                                                <td><t t-esc="row.partner"/></td>
                                                <td><t t-esc="this.fmt(row.amount, state.data.currency_symbol)"/></td>
                                                <td><t t-esc="row.date"/></td>
                                                <td><span t-attf-class="tp_badge tp_badge_#{row.state}"><t t-esc="row.state_label"/></span></td>
                                            </tr>
                                        </t>
                                        <t t-if="!(state.data.recent_orders and state.data.recent_orders.length)">
                                            <tr><td colspan="5" class="tp_no_data">No purchase orders found.</td></tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Top Vendors -->
                            <div class="tp_side_card" t-if="state.data.top_vendors and state.data.top_vendors.length">
                                <div class="tp_table_header"><span><i class="fa fa-building me-2"/>Top Vendors</span></div>
                                <div class="tp_wc_list">
                                    <t t-foreach="state.data.top_vendors or []" t-as="v" t-key="v.name">
                                        <div class="tp_wc_item">
                                            <div class="tp_wc_name"><t t-esc="v.name"/></div>
                                            <div class="tp_wc_pct tp_orange"><t t-esc="this.fmt(v.amount, state.data.currency_symbol)"/></div>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </t>

                </t><!-- end loading check -->
            </div>
        </Layout>
    </t>

</templates>
